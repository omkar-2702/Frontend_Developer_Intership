<!DOCTYPE html>
<html>
<head>
    <title>My Cart</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<nav class="navbar">
    <h2>Catering System</h2>
    <ul>
        <li><a href="view-products.html">Products</a></li>
        <li>
            <a href="cart.html">
                Cart <span id="cartCount" class="cart-badge">0</span>
            </a>
        </li>
        <li><a href="orders.html">My Orders</a></li>
        <li><a href="profile.html">My Profile</a></li>
    </ul>
</nav>

<div class="cart-page">

    <h2>My Cart</h2>

    <div id="cartContainer"></div>

    <div class="cart-summary">
        <h3>Total: â‚¹<span id="totalPrice">0</span></h3>
        <button class="place-order-btn" onclick="placeOrder()">Place Order</button>
    </div>

</div>


<script>
let cart = JSON.parse(localStorage.getItem("cart")) || [];
let container = document.getElementById("cartContainer");

function renderCart() {
    container.innerHTML = "";
    let total = 0;

    if (cart.length === 0) {
        container.innerHTML = "<p>Your cart is empty</p>";
        document.getElementById("totalPrice").innerText = 0;
        return;
    }

    cart.forEach((item, index) => {
        total += item.price * item.quantity;

        container.innerHTML += `
            <div class="cart-item">
                <div>
                    <h4>${item.name}</h4>
                    <p>â‚¹${item.price}</p>
                </div>

                <div class="qty-controls">
                    <button onclick="changeQty(${index}, -1)">âˆ’</button>
                    <span>${item.quantity}</span>
                    <button onclick="changeQty(${index}, 1)">+</button>
                </div>

                <button class="remove-btn" onclick="removeItem(${index})">
                    Remove
                </button>
            </div>
        `;
    });

    document.getElementById("totalPrice").innerText = total;
}

function changeQty(index, change) {
    cart[index].quantity += change;
    if (cart[index].quantity <= 0) cart.splice(index, 1);
    updateCart();
}

function removeItem(index) {
    cart.splice(index, 1);
    updateCart();
}

function updateCart() {
    localStorage.setItem("cart", JSON.stringify(cart));
    renderCart();
}

function placeOrder() {
    if (cart.length === 0) {
        alert("Cart is empty");
        return;
    }

    let orders = JSON.parse(localStorage.getItem("orders")) || [];

    let total = cart.reduce(
        (sum, item) => sum + item.price * item.quantity, 0
    );

    let newOrder = {
        orderId: "ORD-" + Date.now(),
        date: new Date().toLocaleString(),
        items: JSON.parse(JSON.stringify(cart)), // deep copy
        total: total
    };

    orders.push(newOrder);

    // âœ… SAVE orders
    localStorage.setItem("orders", JSON.stringify(orders));

    // âœ… CLEAR cart everywhere
    localStorage.removeItem("cart");

    // âœ… CLEAR badge
    document.getElementById("cartCount").innerText = 0;

    alert("Order placed successfully!");

    // ðŸ”¥ IMPORTANT: force reload without cache
    window.location.replace("orders.html");
}

function updateCartCount() {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    let count = cart.reduce((sum, item) => sum + item.quantity, 0);
    document.getElementById("cartCount").innerText = count;
}

updateCartCount();
renderCart();
</script>

</body>
</html>
